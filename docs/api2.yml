openapi: '3.0.0'
info:
  title: TapDesk REST API
  version: '2.0'
servers:
  - url: /
    description: å½“å‰ç¯å¢ƒ
  - url: http://127.0.0.1:4000
    description: å¼€å‘ç¯å¢ƒ
components:
  securitySchemes:
    Session token:
      type: apiKey
      in: header
      name: x-lc-session
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        nickname:
          type: string
        avatarUrl:
          type: string
    Group:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
    Category:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        parentId: 
          type: string
        position:
          type: number
        active: 
          type: boolean
        template:
          type: string
    File:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        mime:
          type: string
        url:
          type: string
    Evaluation:
      type: object
      properties:
        star:
          type: integer
        content:
          type: string
    Ticket:
      type: object
      properties:
        id:
          type: string
        nid:
          type: integer
        title:
          type: string
        categoryId:
          type: string
        categoryPath:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
        authorId:
          type: string
        author:
          $ref: '#/components/schemas/User'
        assigneeId:
          type: string
        assignee:
          $ref: '#/components/schemas/User'
        groupId:
          type: string
        group:
          $ref: '#/components/schemas/Group'
        files:
          type: array
          items:
            $ref: '#/components/schemas/File'
        status:
          $ref: '#/components/schemas/Status'
        evaluation:
          $ref: '#/components/schemas/Evaluation'
        replyCount:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Status:
      type: integer
      enum: [50, 120, 160, 220, 250, 280]
    Notification:
      type: object
      properties:
        id:
          type: string
        ticket:
          $ref: '#/components/schemas/Ticket'
        unreadCount:
          type: number
        latestAction:
          type: string
          enum: ['newTicket', 'reply', 'changeAssignee', 'ticketEvaluation', 'changeStatus']
        latestActionAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Article:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        content:
          type: string
        contentSafeHTML:
          type: string
        private:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Revision:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        comment:
          type: string
        meta:
          type: boolean
        private:
          type: boolean
        author:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
security:
  - Session token: []
paths:
  /api/2/tickets:
    get:
      tags: [Ticket]
      summary: æŸ¥è¯¢å·¥å•
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
        - name: pageSize
          in: query
          schema:
            type: integer
          description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[0, 100]ï¼Œé»˜è®¤ä¸º 10
        - name: count
          in: query
          schema:
            type: boolean
          description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„å·¥å•æ•°é‡
        - name: authorId
          in: query
          schema:
            type: string
          description: å·¥å•åˆ›å»ºè€… ID
        - name: assigneeId
          in: query
          schema:
            type: string
          description: å·¥å•è´Ÿè´£äºº IDï¼Œå¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”ã€‚`null` è¡¨ç¤ºæœªåˆ†é…è´Ÿè´£äºº
        - name: groupId
          in: query
          schema:
            type: string
          description: å®¢æœç»„ IDï¼Œå¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”ã€‚`null` è¡¨ç¤ºæœªåˆ†é…å®¢æœç»„
        - name: categoryId
          in: query
          schema:
            type: string
          description: åˆ†ç±» IDï¼Œå¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”
        - name: rootCategoryId
          in: query
          schema:
            type: string
          description: æ ¹åˆ†ç±» IDï¼Œç­‰åŒäºå°† categoryId è®¾ç½®ä¸º rootCategoryId + å…¶ä¸‹æ‰€æœ‰å­åˆ†ç±»çš„ ID
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/Status'
        - name: evaluation.star
          in: query
          schema:
            type: integer
            enum: [0, 1]
          description: è¯„ä»·æ˜Ÿçº§
        - name: createdAt
          in: query
          schema:
            type: string
          description: |
            åˆ›å»ºæ—¶é—´çš„èŒƒå›´ï¼Œæ ¼å¼ä¸ºï¼š`{starts}..{ends}`ï¼Œç¼ºçœå€¼ç”¨ `*` è¡¨ç¤ºï¼š

            `2021-09-01T00:00:00.000..*`

            `*..2021-09-30T23:59:59.999`

            `2021-09-01T00:00:00.000..2021-09-30T23:59:59.999`
        - name: orderBy
          in: query
          schema:
            type: string
            enum:
              - createdAt
              - createdAt-desc
              - updatedAt
              - updatedAt-desc
              - latestCustomerServiceReplyAt
              - latestCustomerServiceReplyAt-desc
              - status
              - status-desc
          description: æ’åºå­—æ®µï¼Œé»˜è®¤ä¸ºå‡åºï¼Œ`-desc` åç¼€è¡¨ç¤ºé™åº
        - name: include
          in: query
          schema:
            type: string
          description: |
            å°†æŒ‡å®šå­—æ®µåŒ…å«è¿›æŸ¥è¯¢ç»“æœä¸­ã€‚å¯é€‰å€¼ï¼š
            - author
            - assignee
            - category
            - categoryPath
            - groupï¼ˆä»…å®¢æœå¯ç”¨ï¼‰
            - files
            - unreadCount

            å¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”
        - name: includeMetaKeys
          in: query
          schema:
            type: string
          description: å°†æŒ‡å®š metaData å­—æ®µåŒ…å«è¿›æŸ¥è¯¢ç»“æœä¸­ï¼Œå¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”ã€‚
        - name: where
          in: query
          schema:
            type: string
          description: åº•å±‚æŸ¥è¯¢æ¡ä»¶ï¼Œæ ¼å¼ä¸º JSON å­—ç¬¦ä¸²ã€‚è¯¦è§ [LeanCloud REST API æ–‡æ¡£](https://leancloud.cn/docs/rest_api.html)
      responses:
        '200':
          description: OK
          headers:
            x-total-count:
              schema:
                type: string
                format: integer
              description: ç¬¦åˆæ¡ä»¶çš„å·¥å•æ•°é‡
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
  /api/2/tickets/{id}/replies:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
    post:
      tags: [ticket]
      summary: åˆ›å»ºå›å¤
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                fileIds:
                  type: array
                  items:
                    type: string
                internal:
                  type: boolean
                  description: åˆ›å»ºä¸ºå†…éƒ¨å›å¤ï¼ˆä»…å®¢æœå¯è§ï¼Œè¯¥å‚æ•°ä»…å®¢æœæœ‰æ•ˆï¼‰
              required: [content]
            examples:
              åˆ›å»ºæ™®é€šå›å¤:
                value:
                  content: 'ä½ ä»¬ç»™æˆ‘æçš„è¿™ä¸ªå®¢æœç³»ç»Ÿå•Šâ€”â€”Excited!'
              åˆ›å»ºå¸¦é™„ä»¶çš„å›å¤:
                value:
                  content: 'å¦‚å›¾æ‰€ç¤º'
                  fileIds: ['uploaded-file-id']
              åˆ›å»ºä»…å®¢æœå¯è§çš„å›å¤:
                value:
                  content: 'è¿™ä¸ªç”¨æˆ·è€æ˜¯æä¸€äº›è«åå…¶å¦™çš„é—®é¢˜ ğŸ˜‘'
                  internal: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  content:
                    type: string
                  contentSafeHTML:
                    type: string
                  author:
                    $ref: '#/components/schemas/User'
                  isCustomerService:
                    type: boolean
                  files:
                    type: array
                    items:
                      $ref: '#/components/schemas/File'
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
  /api/2/unread:
    get:
      tags: ['Notification']
      summary: è·å–å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æœªè¯»çš„é€šçŸ¥
      description: é€šå¸¸ç”¨äºåˆ¤æ–­æ˜¯å¦è¦æ˜¾ç¤ºå°çº¢ç‚¹
      responses:
        '200':
          description: è¿”å› true / false
          content:
            application/json:
              schema:
                type: boolean
  /api/2/notifications:
    get:
      tags: ['Notification']
      summary: è·å–å½“å‰ç”¨æˆ·å·¥å•æ›´æ–°é€šçŸ¥
      parameters:
        - name: unread
          in: query
          schema:
            type: string
          description: å¦‚è¯¥å‚æ•°å‡ºç°ï¼ˆå€¼å¯ä»¥ä»»æ„æŒ‡å®šï¼‰ï¼Œåˆ™ä»…è¿”å›æœªè¯»çš„é€šçŸ¥
        - name: before
          in: query
          schema:
            type: string
            description: ISO æ—¶é—´æˆ³ï¼Œé…åˆè¿”å›å€¼ä¸­çš„ latestActionAt ç¿»é¡µ
        - name: limit
          in: query
          schema:
            type: number
            description: æ¯é¡µæ¡æ•°ï¼Œé»˜è®¤ 25ï¼Œæœ€å¤§ 999
        - name: includeTicketMetaKeys
          in: query
          schema:
            type: string
            description: åœ¨è¿”å›ç»“æœçš„ ticket åŒ…å«çš„ metaData å­—æ®µåˆ—è¡¨ï¼Œå¤šä¸ªå€¼ç”¨ `,` åˆ†éš”
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Notification'
  /api/2/notifications/read-all:
    post:
      tags: ['Notification']
      summary: æ‰¹é‡å°†æ‰€æœ‰æœªè¯»é€šçŸ¥æ ‡ä¸ºå·²è¯»
      responses:
        '200':
          description: Done

  /api/2/articles:
    get:
      tags: ['Knowladge base']
      summary: æŸ¥è¯¢æ–‡ç« 
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
        - name: pageSize
          in: query
          schema:
            type: integer
          description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[0, 100]ï¼Œé»˜è®¤ä¸º 20
        - name: private
          in: query
          schema:
            type: boolean
          description: æŒ‡å®šä»…è¿”å› private / public çš„æ–‡ç« ï¼Œä»…å¯¹å®¢æœè´¦å·ç”Ÿæ•ˆï¼ˆç”¨æˆ·ä»…èƒ½çœ‹åˆ° public çš„æ–‡ç« ï¼‰
        - name: count
          in: query
          schema:
            type: boolean
          description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„å·¥å•æ•°é‡
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Article'
    post:
      tags: ['Knowladge base']
      summary: åˆ›å»ºæ–‡ç« 
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                content:
                  type: string
                private:
                  type: boolean
              required: [title, content]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: 
                $ref: '#/components/schemas/Article'

  /api/2/articles/{id}:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Knowladge base']
      summary: è·å–æ–‡ç« 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'
    patch:
      tags: ['Knowladge base']
      summary: æ›´æ–°æ–‡ç« 
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                content:
                  type: string
                private:
                  type: boolean
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
    delete:
      tags: ['Knowladge base']
      summary: åˆ é™¤æ–‡ç« 
      description: å·²ä¸Šçº¿ï¼ˆpublicï¼‰çš„æ–‡ç« ä¸å¯åˆ é™¤ï¼Œä½¿ç”¨ä¸­ï¼ˆæœ‰å…³è”çš„åˆ†ç±»ï¼‰çš„æ–‡ç« ä¸å¯åˆ é™¤ã€‚
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
  /api/2/articles/{id}/categories:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Knowladge base']
      summary: è·å–å…³è”äº†è¯¥æ–‡ç« ä¸ºå¸¸è§é—®é¢˜æˆ–å…¬å‘Šçš„åˆ†ç±»
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /api/2/articles/{id}/revisions:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
      - name: page
        in: query
        schema:
          type: integer
        description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
      - name: pageSize
        in: query
        schema:
          type: integer
        description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[0, 100]ï¼Œé»˜è®¤ä¸º 20
      - name: meta
        in: query
        schema:
          type: boolean
        description: ä¸ºçœŸæ—¶ä»…è¿”å›å‘å¸ƒã€æ’¤é”€å‘å¸ƒè®°å½•ï¼Œä¸ºå‡æ—¶ä»…è¿”å›å†…å®¹ä¿®æ”¹è®°å½•
      - name: count
        in: query
        schema:
          type: boolean
        description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„å·¥å•æ•°é‡
    get:
      tags: ['Knowladge base']
      summary: è·å–æ–‡ç« ä¿®æ”¹è®°å½•
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Revision'
