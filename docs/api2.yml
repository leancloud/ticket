openapi: '3.0.0'
info:
  title: TapSupport REST API
  version: '2.0'
servers:
  - url: /
    description: å½“å‰ç¯å¢ƒ
  - url: http://127.0.0.1:4000
    description: å¼€å‘ç¯å¢ƒ
components:
  parameters:
    dateFrom:
      name: from
      in: query
      required: true
      schema:
        type: string
        format: date-time
    dateTo:
      name: to
      in: query
      required: true
      schema:
        type: string
        format: date-time
    category:
      name: category
      in: query
      schema:
        type: string
      description: Category ID
    customerService:
      name: customerService
      in: query
      schema:
        type: string
      description: å®¢æœ ID
    group:
      name: group
      in: query
      schema:
        type: string
      description: å®¢æœç»„ ID
  securitySchemes:
    Session token:
      type: apiKey
      in: header
      name: x-lc-session
  schemas:
    Tag:
      type: object
      properties:
        key:
          type: string
        value:
          type: string
      required: [key, value]
    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        nickname:
          type: string
        avatarUrl:
          type: string
    Group:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
    Category:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        parentId:
          type: string
          description: çˆ¶åˆ†ç±» IDï¼Œå¯ä»¥é€šè¿‡è¯¥å±æ€§æ„å»ºä¸€é¢—æ ‘
        position:
          type: number
          description: åŒä¸€ä¸ªçˆ¶åˆ†ç±»ä¸‹çš„åºå·
        active:
          type: boolean
        template:
          type: string
          deprecated: true
          description: é—®é¢˜æ¨¡æ¿ï¼ˆå·²è¢«è¡¨å•æ›¿ä»£ï¼‰
    TicketField:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum:
            - text
            - multi-line
            - dropdown
            - multi-select
            - radios
            - file
        title:
          type: string
          description: å­—æ®µåç§°
        description:
          type: string
          description: å­—æ®µè¡¥å……è§£é‡Š
        required:
          type: boolean
          description: æ˜¯å¦å¿…å¡«
    File:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        mime:
          type: string
        url:
          type: string
        thumbnailUrl:
          type: string
    Evaluation:
      type: object
      properties:
        star:
          type: integer
          enum: [0, 1]
        content:
          type: string
        selections:
          type: array
          description: è¯„ä»·çš„é€‰é¡¹
          items:
            type: string
      required: [star]
    Ticket:
      type: object
      properties:
        id:
          type: string
          example: 5ff4324896ba311a0a411392
        nid:
          type: integer
          description: è‡ªå¢ ID
          example: 21430
        title:
          type: string
        categoryId:
          type: string
        categoryPath:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
        authorId:
          type: string
        author:
          $ref: '#/components/schemas/User'
        assigneeId:
          type: string
        assignee:
          $ref: '#/components/schemas/User'
        groupId:
          type: string
        group:
          $ref: '#/components/schemas/Group'
        files:
          type: array
          items:
            $ref: '#/components/schemas/File'
        status:
          $ref: '#/components/schemas/Status'
        evaluation:
          $ref: '#/components/schemas/Evaluation'
        replyCount:
          type: integer
        firstCustomerServiceReplyAt:
          type: string
          format: date-time
        latestCustomerServiceReplyAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          deprecated: true
        contentSafeHTML:
          type: string
          description: è¯¦ç»†æè¿°ï¼ˆå®‰å…¨çš„ HTMLï¼Œå·² XSS è¿‡æ»¤ï¼‰ï¼ˆä»…åœ¨éåˆ—è¡¨ä¸­å‡ºç°)
        unreadCount:
          type: integer
          description: å½“å‰ç”¨æˆ·æœªè¯»æ•°ï¼ˆä»…åœ¨åˆ—è¡¨ä¸­å‡ºç°ï¼‰
    Status:
      type: integer
      enum: [50, 120, 160, 220, 250, 280]
    Reply:
      type: object
      properties:
        id:
          type: string
        content:
          type: string
        contentSafeHTML:
          type: string
          description: å®‰å…¨çš„ HTMLï¼Œå·² XSS è¿‡æ»¤
        author:
          $ref: '#/components/schemas/User'
        isCustomerService:
          type: boolean
        files:
          type: array
          items:
            $ref: '#/components/schemas/File'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    OpsLog:
      type: object
      properties:
        id:
          type: string
        action:
          type: string
          enum:
            [
              'replyWithNoContent',
              'replySoon',
              'resolve',
              'close',
              'reopen',
              'selectAssignee',
              'changeAssignee',
              'changeGroup',
              'changeCategory',
              'changeFields',
            ]
          description: |
            |action|æè¿°|é™„åŠ å­—æ®µ|internal|
            |----|----|----|----|
            |replyWithNoContent|å®¢æœè®¤ä¸ºæ— éœ€å›å¤ï¼ˆå¹¶å°†çŠ¶æ€æ”¹ä¸ºç­‰å¾…ç”¨æˆ·å›å¤ï¼‰|
            |replySoon|å®¢æœè®¤ä¸ºéœ€è¦ä¸€äº›æ—¶é—´å¤„ç†ï¼Œä¼šç¨åå›å¤|
            |resolve|å®¢æœè®¤ä¸ºæˆ–ç”¨æˆ·ç¡®è®¤å·¥å•å·²è§£å†³|
            |close|å·¥å•è¢«å…³é—­|
            |reopen|å·¥å•è¢«é‡æ–°æ‰“å¼€|
            |changeGroup|ç³»ç»Ÿæˆ–æŸå®¢æœä¿®æ”¹äº†å·¥å•å®¢æœç»„|groupId|âœ”ï¸
            |selectAssignee|ç³»ç»Ÿå°†å·¥å•åˆ†é…ç»™äº†æŸå®¢æœ|assigneeId
            |changeAssignee|ç³»ç»Ÿæˆ–æŸå®¢æœå°†å·¥å•äº¤ç»™äº†æŸå®¢æœ|assigneeId
            |changeCategory|ç³»ç»Ÿæˆ–æŸå®¢æœä¿®æ”¹äº†å·¥å•åˆ†ç±»|categoryId
            |changeFields|ç”¨æˆ·æˆ–å®¢æœä¿®æ”¹äº†å·¥å•å­—æ®µ|changes
        operatorId:
          type: string
          description: æ“ä½œè€… IDã€‚ID ä¸º `system` ä»£è¡¨è¯¥æ“ä½œç”±ç³»ç»Ÿè‡ªåŠ¨è§¦å‘ã€‚

    Notification:
      type: object
      properties:
        id:
          type: string
        ticket:
          $ref: '#/components/schemas/Ticket'
        unreadCount:
          type: number
        latestAction:
          type: string
          enum: ['newTicket', 'reply', 'changeAssignee', 'ticketEvaluation', 'changeStatus']
        latestActionAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Article:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        content:
          type: string
        contentSafeHTML:
          type: string
        private:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Topic:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        meta:
          type: object
        articleIds:
          type: array
          items:
            type: string
        articles:
          type: array
          items:
            $ref: '#/components/schemas/Article'
          description: ä»…åœ¨éƒ¨åˆ†å‚æ•°ä¸‹è¿”å›å€¼åŒ…å«è¯¥å­—æ®µ
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Revision:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        comment:
          type: string
        meta:
          type: boolean
        private:
          type: boolean
        author:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
security:
  - Session token: []
paths:
  /api/2/users:
    post:
      tags: [User]
      summary: ç™»å½•
      description: request body ä¸­æä¾›çš„ä¸åŒå­—æ®µå¯¹åº”ä¸åŒçš„ç™»å½•æ–¹å¼ï¼Œè¯¦ç»†ç”¨æ³•å‚è§ä½¿ç”¨æ–‡æ¡£ã€‚
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                jwt:
                  type: string
                anonymousId:
                  type: string
                name:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessionToken:
                    type: string
  /api/2/users/pre-create:
    post:
      tags: [User]
      summary: é¢„æ³¨å†Œ
      description: é€šè¿‡ email æˆ–ç”¨æˆ·åé¢„æ³¨å†Œç”¨æˆ·ã€‚
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                email:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
  /api/2/users/tds/token:
    post:
      tags: [User]
      summary: äº¤æ¢ Token
      description: å°† storage ç­¾å‘çš„ jwt æ¢æˆå®¢æœç³»ç»Ÿç­¾å‘çš„é•¿æœŸ jwt
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                jwt:
                  type: string
                  description: storage ç­¾å‘çš„ jwt
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  jwt:
                    type: string
                    description: å®¢æœç³»ç»Ÿç­¾å‘çš„ jwt

  /api/2/products/{pid}/categories:
    parameters:
      - name: pid
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Category']
      summary: è·å–åˆ†ç±»åˆ—è¡¨
      parameters:
        - name: active
          in: query
          schema:
            type: boolean
          description: æ˜¯å¦åªè¿”å›å·²å¯ç”¨çš„åˆ†ç±»
          example: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /api/2/categories/{cid}/fields:
    parameters:
      - name: cid
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Category']
      summary: è·å–æŸä¸ªåˆ†ç±»å…³è”çš„è¡¨å•æè¿°Â (å·²è¢« /ticket-forms/{id}/items ä»£æ›¿)
      deprecated: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TicketField'
  /api/2/categories/{cid}/faqs:
    parameters:
      - name: cid
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Category', 'Knowladge base']
      summary: è·å–ä¸æŸä¸ªåˆ†ç±»å…³è”çš„ç›¸å…³æ–‡ç« 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Article'
  /api/2/products/{cid}/topics:
    parameters:
      - name: cid
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Category', 'Knowladge base']
      summary: è·å–ä¸æŸä¸ªåˆ†ç±»å…³è”çš„ Topics
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Topic'

  /api/2/tickets:
    get:
      tags: [Ticket]
      summary: æŸ¥è¯¢å·¥å•
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
        - name: pageSize
          in: query
          schema:
            type: integer
          description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[0, 100]ï¼Œé»˜è®¤ä¸º 10
        - name: count
          in: query
          schema:
            type: boolean
          description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„å·¥å•æ•°é‡
        - name: authorId
          in: query
          schema:
            type: string
          description: å·¥å•åˆ›å»ºè€… ID
        - name: assigneeId
          in: query
          schema:
            type: string
          description: å·¥å•è´Ÿè´£äºº IDï¼Œå¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”ã€‚`null` è¡¨ç¤ºæœªåˆ†é…è´Ÿè´£äºº
        - name: groupId
          in: query
          schema:
            type: string
          description: å®¢æœç»„ IDï¼Œå¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”ã€‚`null` è¡¨ç¤ºæœªåˆ†é…å®¢æœç»„
        - name: categoryId
          in: query
          schema:
            type: string
          description: åˆ†ç±» IDï¼Œå¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”
        - name: product
          in: query
          schema:
            type: string
          description: æ ¹åˆ†ç±» IDï¼Œç­‰åŒäºå°† categoryId è®¾ç½®ä¸º product + å…¶ä¸‹æ‰€æœ‰å­åˆ†ç±»çš„ ID
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/Status'
        - name: evaluation.star
          in: query
          schema:
            type: integer
            enum: [0, 1]
          description: è¯„ä»·æ˜Ÿçº§
        - name: createdAt
          in: query
          schema:
            type: string
          description: |
            åˆ›å»ºæ—¶é—´çš„èŒƒå›´ï¼Œæ ¼å¼ä¸ºï¼š`{starts}..{ends}`ï¼Œç¼ºçœå€¼ç”¨ `*` è¡¨ç¤ºï¼š

            `2021-09-01T00:00:00.000..*`

            `*..2021-09-30T23:59:59.999`

            `2021-09-01T00:00:00.000..2021-09-30T23:59:59.999`
        - name: orderBy
          in: query
          schema:
            type: string
            enum:
              - createdAt
              - createdAt-desc
              - updatedAt
              - updatedAt-desc
              - latestCustomerServiceReplyAt
              - latestCustomerServiceReplyAt-desc
              - status
              - status-desc
          description: æ’åºå­—æ®µï¼Œé»˜è®¤ä¸ºå‡åºï¼Œ`-desc` åç¼€è¡¨ç¤ºé™åº
        - name: include
          in: query
          schema:
            type: string
          description: |
            å°†æŒ‡å®šå­—æ®µåŒ…å«è¿›æŸ¥è¯¢ç»“æœä¸­ã€‚å¯é€‰å€¼ï¼š
            - author
            - assignee
            - category
            - categoryPath
            - groupï¼ˆä»…å®¢æœå¯ç”¨ï¼‰
            - files
            - unreadCount

            å¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”
        - name: includeMetaKeys
          in: query
          schema:
            type: string
          description: å°†æŒ‡å®š metaData å­—æ®µåŒ…å«è¿›æŸ¥è¯¢ç»“æœä¸­ï¼Œå¤šä¸ªå€¼å¯ç”¨ `,` åˆ†éš”ã€‚
        - name: where
          in: query
          schema:
            type: string
          description: ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰åº•å±‚æŸ¥è¯¢æ¡ä»¶ï¼Œæ ¼å¼ä¸º JSON å­—ç¬¦ä¸²ã€‚è¯¦è§ [LeanCloud REST API æ–‡æ¡£](https://leancloud.cn/docs/rest_api.html)
      responses:
        '200':
          description: OK
          headers:
            x-total-count:
              schema:
                type: string
                format: integer
              description: ç¬¦åˆæ¡ä»¶çš„å·¥å•æ•°é‡ï¼ˆä»…å½“æŒ‡å®š count å‚æ•°æ—¶è¿”å›ï¼‰
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
    post:
      tags: [Ticket]
      summary: åˆ›å»ºå·¥å•
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                categoryId:
                  type: string
                title:
                  type: string
                  description: æ ‡é¢˜ï¼Œæœ€å¤§é•¿åº¦ 100 å­—ç¬¦ï¼ˆå·²è¢«è¡¨å•ç³»ç»Ÿå­—æ®µä»£æ›¿ï¼‰
                  deprecated: true
                content:
                  type: string
                  description: å†…å®¹ï¼Œæ”¯æŒ Markdownï¼ˆå·²è¢«è¡¨å•ç³»ç»Ÿå­—æ®µä»£æ›¿ï¼‰
                  deprecated: true
                fileIds:
                  type: array
                  items:
                    type: string
                  description: é™„ä»¶æ–‡ä»¶ ID åˆ—è¡¨ï¼ˆå·²è¢«è¡¨å•ç³»ç»Ÿå­—æ®µä»£æ›¿ï¼‰
                  deprecated: true
                customFields:
                  type: array
                  description: å·¥å•å­—æ®µ
                  items:
                    type: object
                    properties:
                      field:
                        type: string
                        description: å·¥å•å­—æ®µ ID
                      value:
                        type: mixed
                        description: å·¥å•å­—æ®µå€¼
              required: [title, categoryId]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string

  /api/2/ticket/{id}:
    parameters:
      - name: id
        in: path
        description: å·¥å• ID
        schema:
          type: string
        required: true
    get:
      tags: [Ticket]
      summary: è·å–å·¥å•è¯¦æƒ…
      parameters:
        - name: includeAuthor
          in: query
          schema:
            type: boolean
        - name: includeAssignee
          in: query
          schema:
            type: boolean
        - name: includeCategory
          in: query
          schema:
            type: boolean
        - name: includeGroup
          in: query
          schema:
            type: boolean
        - name: includeFiles
          in: query
          schema:
            type: boolean
        - name: includeCategoryPath
          in: query
          schema:
            type: boolean
        - name: includeUnreadCount
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
    patch:
      tags: [Ticket]
      summary: æ›´æ–°å·¥å•ä¿¡æ¯
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                assigneeId:
                  type: string
                  nullable: true
                groupId:
                  type: string
                  nullable: true
                categoryId:
                  type: string
                organizationId:
                  type: string
                  nullable: true
                tags:
                  type: array
                  items:
                    $ref: '#/components/schemas/Tag'
                privateTags:
                  type: array
                  items:
                    $ref: '#/components/schemas/Tag'
                evaluation:
                  $ref: '#/components/schemas/Evaluation'
      responses:
        '200':
          description: OK

  /api/2/tickets/{id}/replies:
    parameters:
      - name: id
        in: path
        description: å·¥å• ID
        schema:
          type: string
        required: true
    get:
      tags: [Ticket]
      summary: è·å–å›å¤
      parameters:
        - name: orderBy
          in: query
          schema:
            type: string
            enum:
              - createdAt
              - createdAt-desc
          description: æ’åºå­—æ®µï¼Œé»˜è®¤ä¸ºå‡åºï¼Œ`-desc` åç¼€è¡¨ç¤ºé™åº
        - name: pageSize
          in: query
          schema:
            type: integer
          description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[1, 1000]ï¼Œé»˜è®¤ä¸º 100
        - name: page
          in: query
          schema:
            type: integer
          description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
        - name: cursor
          in: query
          schema:
            type: string
            format: date-time
          description: ä»¥è¿”å›ç»“æœçš„ createdAt ä½œä¸ºæ¸¸æ ‡åŠ è½½æ›´å¤šã€‚å¦‚æœæŒ‡å®š cursorï¼Œpage å‚æ•°å°†è¢«å¿½ç•¥ã€‚
        - name: count
          in: query
          schema:
            type: boolean
          description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„å›å¤æ•°é‡ã€‚
      responses:
        '200':
          description: OK
          headers:
            x-total-count:
              schema:
                type: string
                format: integer
              description: ç¬¦åˆæ¡ä»¶çš„å›å¤æ•°é‡ï¼ˆä»…å½“æŒ‡å®š count å‚æ•°æ—¶è¿”å›ï¼‰
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Reply'
    post:
      tags: [Ticket]
      summary: åˆ›å»ºå›å¤
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                fileIds:
                  type: array
                  items:
                    type: string
                internal:
                  type: boolean
                  description: åˆ›å»ºä¸ºå†…éƒ¨å›å¤ï¼ˆä»…å®¢æœå¯è§ï¼Œè¯¥å‚æ•°ä»…å®¢æœæœ‰æ•ˆï¼‰
              required: [content]
            examples:
              åˆ›å»ºæ™®é€šå›å¤:
                value:
                  content: 'ä½ ä»¬ç»™æˆ‘æçš„è¿™ä¸ªå®¢æœç³»ç»Ÿå•Šâ€”â€”Excited!'
              åˆ›å»ºå¸¦é™„ä»¶çš„å›å¤:
                value:
                  content: 'å¦‚å›¾æ‰€ç¤º'
                  fileIds: ['uploaded-file-id']
              åˆ›å»ºä»…å®¢æœå¯è§çš„å›å¤:
                value:
                  content: 'è¿™ä¸ªç”¨æˆ·è€æ˜¯æä¸€äº›è«åå…¶å¦™çš„é—®é¢˜ ğŸ˜‘'
                  internal: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  content:
                    type: string
                  contentSafeHTML:
                    type: string
                  author:
                    $ref: '#/components/schemas/User'
                  isCustomerService:
                    type: boolean
                  files:
                    type: array
                    items:
                      $ref: '#/components/schemas/File'
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time

  /api/2/tickets/{id}/ops-logs:
    parameters:
      - name: id
        in: path
        description: å·¥å• ID
        schema:
          type: string
        required: true
    get:
      tags: [Ticket]
      summary: è·å–æ“ä½œæ—¥å¿—
      parameters:
        - name: orderBy
          in: query
          schema:
            type: string
            enum:
              - createdAt
              - createdAt-desc
          description: æ’åºå­—æ®µï¼Œé»˜è®¤ä¸ºå‡åºï¼Œ`-desc` åç¼€è¡¨ç¤ºé™åº
        - name: pageSize
          in: query
          schema:
            type: integer
          description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[1, 1000]ï¼Œé»˜è®¤ä¸º 100
        - name: page
          in: query
          schema:
            type: integer
          description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
        - name: cursor
          in: query
          schema:
            type: string
            format: date-time
          description: ä»¥è¿”å›ç»“æœçš„ createdAt ä½œä¸ºæ¸¸æ ‡åŠ è½½æ›´å¤šã€‚å¦‚æœæŒ‡å®š cursorï¼Œpage å‚æ•°å°†è¢«å¿½ç•¥ã€‚
        - name: count
          in: query
          schema:
            type: boolean
          description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„æ—¥å¿—æ•°é‡ã€‚
      responses:
        '200':
          description: OK
          headers:
            x-total-count:
              schema:
                type: string
                format: integer
              description: ç¬¦åˆæ¡ä»¶çš„æ—¥å¿—æ•°é‡ï¼ˆä»…å½“æŒ‡å®š count å‚æ•°æ—¶è¿”å›ï¼‰
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OpsLog'

  /api/2/ticket-stats:
    get:
      tags: [TicketStats]
      summary: è·å–åŸºæœ¬çš„ç»Ÿè®¡ä¿¡æ¯
      description: åŒ…å«å·¥å•æ•°é‡ã€å›å¤æ—¶é—´ç­‰
      parameters:
        - $ref: '#/components/parameters/dateTo'
        - $ref: '#/components/parameters/dateFrom'
        - $ref: '#/components/parameters/category'
        - $ref: '#/components/parameters/customerService'
        - $ref: '#/components/parameters/group'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  created:
                    type: integer
                    description: æ–°å»ºå·¥å•æ•°é‡
                  closed:
                    type: integer
                    description: å…³é—­å·¥å•æ•°é‡
                  reopened:
                    type: integer
                    description: æ¿€æ´»å·¥å•æ•°é‡
                  conversion:
                    type: integer
                    description: æµè½¬æ•°
                  internalConversion:
                    type: integer
                  externalConversion:
                    type: integer
                  replyTime:
                    type: integer
                  replyTimeCount:
                    type: integer
                  replyCount:
                    type: integer
                  firstReplyTime:
                    type: integer
                  firstReplyCount:
                    type: integer
                  weekdayReplyTime:
                    type: integer
                  weekdayReplyTimeCount:
                    type: integer
                  weekdayReplyCount:
                    type: integer
                  internalReplyCount:
                    type: integer
                  naturalReplyTime:
                    type: integer
                  naturalReplyCount:
                    type: integer
                  likeCount:
                    type: integer
                  dislikeCount:
                    type: integer
                  likeRate:
                    type: number
                  dislikeRate:
                    type: number
                required: [likeCount, dislikeCount, likeRate, dislikeRate]

  /api/2/ticket-stats/fields:
    get:
      tags: [TicketStats]
      summary: è·å–æŸä¸ª field çš„è¯¦ç»†ç»Ÿè®¡
      parameters:
        - $ref: '#/components/parameters/dateTo'
        - $ref: '#/components/parameters/dateFrom'
        - $ref: '#/components/parameters/category'
        - $ref: '#/components/parameters/customerService'
        - $ref: '#/components/parameters/group'
        - name: fields
          in: query
          required: true
          schema:
            type: array
            items:
              type: string
        - name: bySelection
          in: query
          description: |
            æ§åˆ¶è¯„ä»·ç»Ÿè®¡æ˜¯å¦ä»¥ selection æ¥åˆ†
            åªå¯¹ likeCount å’Œ dislikeCount çš„ field æœ‰æ•ˆ
            ä¸º false æ—¶è¿”å›ä½“é‡Œä¸ä¼šå‡ºç° selection å­—æ®µ
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      type: object
                      properties:
                        likeCount:
                          type: integer
                        dislikeCount:
                          type: integer
                        categoryId:
                          type: string
                        customerServiceId:
                          type: string
                        selection:
                          type: string
                  - type: array
                    items:
                      type: object
                      properties:
                        date:
                          type: string
                          format: date-time
                        created:
                          type: integer
                        closed:
                          type: integer
                        reopened:
                          type: integer
                        conversion:
                          type: integer
                        firstReplyTime:
                          type: integer
                        firstReplyCount:
                          type: integer
                        replyTime:
                          type: integer
                        replyTimeCount:
                          type: integer
                        naturalReplyTime:
                          type: integer
                        naturalReplyCount:
                          type: integer
                        replyCount:
                          type: integer
                        internalReplyCount:
                          type: integer
                        categoryId:
                          type: string
                        customerServiceId:
                          type: string

  /api/2/ticket-stats/status:
    get:
      tags: [TicketStats]
      parameters:
        - $ref: '#/components/parameters/dateTo'
        - $ref: '#/components/parameters/dateFrom'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    date:
                      type: string
                      format: date-time
                    notProcessed:
                      type: integer
                    waitingCustomer:
                      type: integer
                    waitingCustomerService:
                      type: integer
                    preFulfilled:
                      type: integer
                    fulfilled:
                      type: integer
                    closed:
                      type: integer

  /api/2/ticket-stats/details:
    get:
      tags: [TicketStats]
      parameters:
        - $ref: '#/components/parameters/dateTo'
        - $ref: '#/components/parameters/dateFrom'
        - $ref: '#/components/parameters/category'
        - $ref: '#/components/parameters/customerService'
        - $ref: '#/components/parameters/group'
        - name: field
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    nid:
                      type: integer
                    replyTime:
                      type: integer

  /api/2/ticket-stats/count:
    get:
      tags: [TicketStats]
      parameters:
        - $ref: '#/components/parameters/dateTo'
        - $ref: '#/components/parameters/dateFrom'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: integer

  /api/2/ticket-stats/realtime:
    get:
      tags: [TicketStats]
      description: å¾…è¡¥å…¨
      responses:
        '200':
          description: OK

  /api/2/unread:
    get:
      tags: ['Notification']
      summary: è·å–å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æœªè¯»çš„é€šçŸ¥
      description: é€šå¸¸ç”¨äºåˆ¤æ–­æ˜¯å¦è¦æ˜¾ç¤ºå°çº¢ç‚¹
      responses:
        '200':
          description: è¿”å› true / false
          content:
            application/json:
              schema:
                type: boolean
      parameters:
        - name: product
          in: query
          schema:
            type: string
          description: åªè¿”å›å±äºæŒ‡å®š product ä¸‹çš„åˆ†ç±»çš„å·¥å•çš„æœªè¯»æƒ…å†µ
  /api/2/notifications:
    get:
      tags: ['Notification']
      summary: è·å–å½“å‰ç”¨æˆ·å·¥å•æ›´æ–°é€šçŸ¥
      parameters:
        - name: product
          in: query
          schema:
            type: string
          description: åªè¿”å›å±äºæŒ‡å®š product ä¸‹çš„åˆ†ç±»çš„å·¥å•æ›´æ–°é€šçŸ¥
        - name: unread
          in: query
          schema:
            type: string
          description: å¦‚è¯¥å‚æ•°å‡ºç°ï¼ˆå€¼å¯ä»¥ä»»æ„æŒ‡å®šï¼‰ï¼Œåˆ™ä»…è¿”å›æœªè¯»çš„é€šçŸ¥
        - name: before
          in: query
          schema:
            type: string
            description: ISO æ—¶é—´æˆ³ï¼Œé…åˆè¿”å›å€¼ä¸­çš„ latestActionAt ç¿»é¡µ
        - name: limit
          in: query
          schema:
            type: number
            description: æ¯é¡µæ¡æ•°ï¼Œé»˜è®¤ 25ï¼Œæœ€å¤§ 999
        - name: includeTicketMetaKeys
          in: query
          schema:
            type: string
            description: åœ¨è¿”å›ç»“æœçš„ ticket åŒ…å«çš„ metaData å­—æ®µåˆ—è¡¨ï¼Œå¤šä¸ªå€¼ç”¨ `,` åˆ†éš”
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Notification'
  /api/2/notifications/read-all:
    post:
      tags: ['Notification']
      summary: æ‰¹é‡å°†æ‰€æœ‰æœªè¯»é€šçŸ¥æ ‡ä¸ºå·²è¯»
      parameters:
        - name: product
          in: query
          schema:
            type: string
          description: åªæ ‡è®°æŒ‡å®š product ä¸‹çš„åˆ†ç±»çš„å·¥å•å·²è¯»
      responses:
        '200':
          description: Done

  /api/2/articles:
    get:
      tags: ['Knowladge base']
      summary: æŸ¥è¯¢æ–‡ç« 
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
        - name: pageSize
          in: query
          schema:
            type: integer
          description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[0, 100]ï¼Œé»˜è®¤ä¸º 20
        - name: private
          in: query
          schema:
            type: boolean
          description: æŒ‡å®šä»…è¿”å› private / public çš„æ–‡ç« ï¼Œä»…å¯¹å®¢æœè´¦å·ç”Ÿæ•ˆï¼ˆç”¨æˆ·ä»…èƒ½çœ‹åˆ° public çš„æ–‡ç« ï¼‰
        - name: count
          in: query
          schema:
            type: boolean
          description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„æ–‡ç« æ•°é‡
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Article'
    post:
      tags: ['Knowladge base']
      summary: åˆ›å»ºæ–‡ç« 
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                content:
                  type: string
                private:
                  type: boolean
              required: [title, content]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'

  /api/2/articles/{id}:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Knowladge base']
      summary: è·å–æ–‡ç« 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'
    patch:
      tags: ['Knowladge base']
      summary: æ›´æ–°æ–‡ç« 
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                content:
                  type: string
                private:
                  type: boolean
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
    delete:
      tags: ['Knowladge base']
      summary: åˆ é™¤æ–‡ç« 
      description: å·²ä¸Šçº¿ï¼ˆpublicï¼‰çš„æ–‡ç« ä¸å¯åˆ é™¤ï¼Œä½¿ç”¨ä¸­ï¼ˆæœ‰å…³è”çš„åˆ†ç±»ï¼‰çš„æ–‡ç« ä¸å¯åˆ é™¤ã€‚
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
  /api/2/articles/{id}/categories:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Knowladge base']
      summary: è·å–å…³è”äº†è¯¥æ–‡ç« ä¸ºç›¸å…³æ–‡ç« æˆ–å…¬å‘Šçš„åˆ†ç±»
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /api/2/articles/{id}/feedback:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
    post:
      tags: ['Knowladge base']
      summary: æäº¤æ–‡ç« åé¦ˆ
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: integer
                  enum: [-1, 1]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object

  /api/2/articles/{id}/revisions:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
      - name: page
        in: query
        schema:
          type: integer
        description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
      - name: pageSize
        in: query
        schema:
          type: integer
        description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[0, 100]ï¼Œé»˜è®¤ä¸º 20
      - name: meta
        in: query
        schema:
          type: boolean
        description: ä¸ºçœŸæ—¶ä»…è¿”å›å‘å¸ƒã€æ’¤é”€å‘å¸ƒè®°å½•ï¼Œä¸ºå‡æ—¶ä»…è¿”å›å†…å®¹ä¿®æ”¹è®°å½•
      - name: count
        in: query
        schema:
          type: boolean
        description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„è®°å½•æ•°é‡
    get:
      tags: ['Knowladge base']
      summary: è·å–æ–‡ç« ä¿®æ”¹è®°å½•
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Revision'

  /api/2/products/{pid}/notices:
    parameters:
      - name: pid
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Knowladge base']
      summary: è·å–å…¬å‘Š
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /api/2/topics:
    get:
      tags: ['Knowladge base']
      summary: æŸ¥è¯¢ Topic
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          description: é¡µæ•°ï¼ŒèŒƒå›´ï¼š[1, Infinity)
        - name: pageSize
          in: query
          schema:
            type: integer
          description: æ¯é¡µæ•°é‡ï¼ŒèŒƒå›´ï¼š[0, 100]ï¼Œé»˜è®¤ä¸º 10
        - name: count
          in: query
          schema:
            type: boolean
          description: ä¸º `true` æ—¶é€šè¿‡ x-total-count è¿”å›ç¬¦åˆæ¡ä»¶çš„ topic æ•°é‡
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Topic'
    post:
      tags: ['Knowladge base']
      summary: åˆ›å»º Topic
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                articleIds:
                  type: array
                  items:
                    type: string
                meta:
                  type: object
              required: [name, articleIds]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Topic'

  /api/2/topics/{id}:
    parameters:
      - name: id
        in: path
        schema:
          type: string
        required: true
    get:
      tags: ['Knowladge base']
      summary: è·å– Topic
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Topic'
    patch:
      tags: ['Knowladge base']
      summary: æ›´æ–° Topic
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                articleIds:
                  type: array
                  items:
                    type: string
                meta:
                  type: object
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
    delete:
      tags: ['Knowladge base']
      summary: åˆ é™¤ Topic
      description: ä½¿ç”¨ä¸­ï¼ˆæœ‰å…³è”çš„åˆ†ç±»ï¼‰çš„æ–‡ç« ä¸å¯åˆ é™¤ã€‚
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object

  /api/2/external-files:
    post:
      tags: [File]
      summary: æ³¨å†Œå¤–éƒ¨æ–‡ä»¶
      description: æ”¯æŒæäº¤æ–‡ä»¶çš„æ¥å£ä½¿ç”¨æ–‡ä»¶ ID ä½œä¸ºå‚æ•°ï¼Œå¤–éƒ¨æ–‡ä»¶éœ€è¦å…ˆé€šè¿‡æ­¤æ¥å£æ³¨å†Œä»¥è·å–æ–‡ä»¶ IDã€‚
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  url:
                    type: string
                    required: true
                  name:
                    type: string
                    description: ç”¨æˆ·æ–‡ä»¶å±•ç¤ºæ—¶çš„åå­—ã€‚å¦‚ä¸æŒ‡å®šåˆ™ä½¿ç”¨ URL ä¸­çš„æœ€åä¸€çº§è·¯å¾„ã€‚
                  type:
                    type: string
                    description: MIME type
                  metaData:
                    type: object
                    description: KV æ¥å£çš„çš„å…ƒæ•°æ®ï¼Œå¯ç”¨äºç­›é€‰ã€‚
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  description: æ–‡ä»¶ ID
